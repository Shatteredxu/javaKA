## redis面试

###### 1.redis使用场景

缓存session共享分布式锁计数器限流



--------------------------

43. 文件事件处理器
    
    套接字、I/O多路复用程序、文件事件分派器（dispatcher），事件处理器
    
    通过使用由I/O多路复用技术实现的文件事件处理器，Redis服务器使用单线程单进程的方式来处理命令请求，并与多个客户端进行网络通信。

44. 客户端
    
    redis通过**链表**来保存所有客户端的状态信息，
    
    客户端状态的**fd属性**记录了客户端正在使用的套接字描述符
    
    客户端的标志属性flags记录了客户端的角色（role）
    
    客户端状态的输入缓冲区用于保存客户端发送的命令请求

45. 客户端的连接与关闭
    
    硬性限制，软性限制
    
     Lua脚本的伪客户端（一直存在）

46. serverCron函数
    
    serverCron函数默认每隔100毫秒执行一次，这个函数负责管理服务器的资源，并保持服务器自身的良好运转。（例如 1)更新服务器时间缓存,2)更新LRU时钟3)更新服务器每秒执行命令次数4. 更新服务器内存峰值记录5.处理SIGTERM信号6.管理客户端资源7. 管理数据库资源8. 执行被延迟的BGREWRITEAOF 9. 检查持久化操作的运行状态10.将AOF缓冲区中的内容写入AOF文件11. 增加cronloops计数器的值）
    
    lru属性保存了对象最后一次被命令访问的时间,用于计算值对象的空转时长，
    
    服务器状态中的stat_peak_memory属性记录了服务器的内存峰值大小：

47. 初始化服务器步骤
    
    1 初始化状态变量，设置各个属性（运行id，端口号）
    
    2  载入配置选项
    
    3 初始化服务器数据结构
    
    4 还原数据库
    
    5 执行时间循环
    
    #### 2021年03月25日
    
    -------------------

48. 同步和命令传播

49. PSYNC命令的实现的完整过程
    
    初始复制->网络中断–>重新从中断处复制

50. 复制功能实现的完整步骤

51. REPLCONF ACK心跳检测
    
    检测主从服务器的网络连接状态，辅助实现min-slaves选项，检测命令丢失

52. redis 的Sentinel系统
    
    由一个或多个Sentinel实例（instance）组成的Sentinel系统（system）可以监视任意多个主服务器，以及这些主服务器属下的所有从服务器，并在被监视的主服务器进入下线状态时，自动将下线主服务器属下的某个从服务器升级为新的主服务器，然后由新的主服务器代替已下线的主服务器继续处理命令请求，
    
    1).启动Sentinel系统，也就是初始化一个普通的redis服务器，不过不用执行持久化文件
    
    2).使用Sentinel专用代码，PING、SENTINEL、INFO、SUBSCRIBE、UNSUBSCRIBE、PSUBSCRIBE和PUNSUBSCRIBE这七个命令就是客户端可以对Sentinel执行的全部命令
    
    3).初始化Sentinel状态的masters属性
    
    4).创建连向主服务器的网络连接（命令连接，订阅连接）
    
    #### 2021年03月30日
    
    --------------

53. 选举领头Sentinel
    
    （高可用方案）
    
    Sentinel系统选举领头Sentinel的方法是对==Raft算法的领头选举==方法的实现

54. 新的主服务器是怎样挑选出来的

55. redis集群
    
    redis集群通过分片（sharding）来进行数据共享，并提供复制和故障转移功能。
    
    槽指派、命令执行、重新分片、转向、故障转移、消息
    
    通过CLUSTER MEET命令进行握手
    
    集群数据结构：1.clusterNode结构保存了一个节点的当前状态。clusterLink，clusterState

56. 槽指派

57. 

58. Redis主从复制功能和实现原理
    
    #### 2021年03月31日
    
    -----------

59. Redis的LRU策略，定期删除策略

60. Redis哨兵，主从同步
    
    客户端每次先访问Sentinel节点，寻找master节点的地址，然后再去访问master节点，并不断监控主节点，如果主节点宕机了，则Sentinel会立即更换主节点的地址
    
    > Sentinel主节点更换客户端如何感知？？
    > 
    > 1. 连接池建立新连接时，会去查询主库地址，然后跟内存中的主库地址进行比对，如果变
    >    更了，就断开所有连接，重新使用新地址建立新连接。如果是旧的主库挂掉了，那么所有正
    >    在使用的连接都会被关闭，然后在重连时就会用上新地址。
    > 2. 如果不在建立新的连接，也可以更换地址，在执行修改性命令的时候会捕获了一个特殊的异常 ReadOnlyError，这个异常会把所有的旧连接给关闭
    
    CAP理论：网络分区发生时，一致性和可用性两难全，但保持**最终一致性**；
    
    redis支持主从同步和**从从同步**，增量同步，快照同步，无盘复制，

61. **Redis分布式锁**
    
    https://www.zhihu.com/question/300767410?sort=created
    
    之前获取锁用 `setnx`（set if not exists） 指令，只允许被一个客户端占坑。先来先占，调用 del 指令释放“坑”。
    
    Redis2.8后面可以使用set指令，`set XXX true ex 5nx` 获取锁和设置过期时间指令一同执行

62. **异步队列**

63. **Redis实现限流**
    
    1. 使用zset维护一个时间窗口，记录时间窗口中的数据，（Redis的流水线Pipelined）
    2. 漏斗限流算法
    3. 令牌桶算法（redis-cell模块）

64. 位图

65. 统计用户UV(HyperLogLog)

66. 布隆过滤器以及布谷鸟过滤器
    
    布谷鸟过滤器：https://juejin.cn/post/6844903861749055502

67. scan

68. 优雅使用jedis
    
    jedis就是将Redis封装起来对外提供调用接口来操控redis的一个工具。
    
    使用redis池 jedisPool，需要使用完毕关闭连接，**在catch中增加重试机制**
    
    jedis的完整的封装代码：

69. 保护Redis
    
    Redis 有一些非常危险的指令，比如 **keys 指令会导致 Redis 卡顿**，**flushdb 和 flushall 会让 Redis 的所有数据全**
    **部清空**
    
    1. rename-command 指令用于将某些危险的指令修改成特别的名称，用来避免人为误操作。改名成空串就相当于禁用
    
    2. Redis 的密码访问限制
    
    3. Redis 并不支持 SSL 链接，需要使用ssl代理来提供远程连接，spiped工具

70. 

71. 

72. 