第8章　备份与恢复
-----------------

[TOC]



### 备份与恢复概述

###### 根据**备份的方法不同**可以将备份分为：

❑Hot Backup（热备）

❑Cold Backup（冷备）

❑Warm Backup（温备）

* Hot Backup是指数据库运行中直接备份，对正在运行的数据库操作没有任何的影响
* Cold Backup是指备份操作是在数据库停止的情况下,一般只需要复制相关的数据库物理文件
* Warm Backup备份同样是在数据库运行中进行的，但是会对当前数据库的操作有所影响，如加一个全局读锁以保证备份数据的一致性

###### 按照**备份后文件的内容**，备份又可以分为：

❑逻辑备份

❑裸文件备份

逻辑备份是指**备份出的文件内容是可读的**，一般是文本文件。内容一般是由一**条条SQL语句，或者是表内实际数据组成**。如mysqldump和SELECT*INTO OUTFILE的方法。这类方法的好处是可以观察导出文件的内容，一般适用于数据库的升级、迁移等工作。但其缺点是恢复所需要的时间往往较长。

裸文件备份是指复制数据库的物理文件，既可以是在数据库运行中的复制（如ibbackup、xtrabackup这类工具），也可以是在数据库停止运行时直接的数据文件复制。这类备份的恢复时间往往较逻辑备份短很多。

###### 若按照**备份数据库的内容**来分，备份又可以分为：

❑完全备份

❑增量备份

❑日志备份

完全备份是指对数据库进行一个完整的备份。增量备份是指在上次完全备份的基础上，对于更改的数据进行备份。日志备份主要是指对MySQL数据库二进制日志的备份，通过对一个完全备份进行二进制日志的重做（replay）来完成数据库的point-in-time的恢复工作

### 冷备

对于InnoDB存储引擎的冷备非常简单，只需要备份MySQL数据库的frm文件，共享表空间文件，独立表空间文件（*.ibd），重做日志文件。另外建议定期备份MySQL数据库的配置文件my.cnf，这样有利于恢复的操作。

在同一台机器上对数据库进行冷备是远远不够的，至少还需要将本地产生的备份存放到一台远程的服务器中，确保不会因为本地数据库的宕机而影响备份文件的使用。

**冷备的优点是：**

❑备份简单，只要复制相关文件即可。

❑备份文件易于在不同操作系统，不同MySQL版本上进行恢复。

❑恢复相当简单，只需要把文件恢复到指定位置即可。

❑恢复速度快，不需要执行任何SQL语句，也不需要重建索引。

**冷备的缺点是：**

❑InnoDB存储引擎冷备的文件通常比逻辑文件大很多，因为表空间中存放着很多其他的数据，如undo段，插入缓冲等信息。

❑冷备也不总是可以轻易地跨平台。操作系统、MySQL的版本、文件大小写敏感和浮点数格式都会成为问题。

### 逻辑备份

##### mysqldump

##### SELECT...INTO OUTFILE

##### mysqlimport

### bin Log备份与恢复

MySQL的二进制日志（binary log）是一个二进制文件，主要用于**记录修改数据或有可能引起数据变更的MySQL语句**

二进制日志（binary log）中记录了对**MySQL数据库执行更改的所有操作**，并且记录了<u>语句发生时间</u>、<u>执行时长</u>、操作数据等其它额外信息，但是它<u>不记录SELECT、SHOW等那些不修改数据的SQL语句</u>。二进制日志（binary log）**主要用于数据库恢复和主从复制，以及审计（audit）操作**。

`show variables like 'log_bin'`查看是否开启二进制日志备份



### 热备

##### ibbackup

ibbackup是InnoDB存储引擎官方提供的热备工具，可以同时备份MyISAM存储引擎和InnoDB存储引擎表

##### XtraBackup

XtraBackup备份工具是由Percona公司开发的开源热备工具

##### XtraBackup实现增量备份

### 快照备份

